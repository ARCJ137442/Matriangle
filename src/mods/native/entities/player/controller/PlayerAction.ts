import { mRot } from 'matriangle-api/server/general/GlobalRot'
import { int } from 'matriangle-legacy/AS3Legacy'

/**
 * ç©å®¶äº‹ä»¶ï¼šä»ã€Œæ§åˆ¶å™¨ã€å‘ç©å®¶å›åˆ†æ´¾çš„äº‹ä»¶ç±»å‹
 * * ç»§æ‰¿è‡ª{@link MatrixEventType}
 * * ç›®å‰åªæœ‰ä¸€ä¸ªâ€”â€”æ·»åŠ åŠ¨ä½œ
 *
 * !ã€2023-10-14 15:04:28ã€‘ä¸ã€Œç©å®¶å‘ŠçŸ¥ç»™æ§åˆ¶å™¨çš„{@link PlayerEvent}ä¸åŒã€
 */
export enum NativeMatrixPlayerEvent {
	ADD_ACTION = 'addAction',
}

/**
 * æ€»ä½“çš„ã€Œç©å®¶è¡Œä¸ºã€ç±»å‹
 * * å­—ç¬¦ä¸²å¯¹åº”ã€Œæ— å‚è¡Œä¸ºã€
 * * æ•°å€¼ç”¨äºè¡¨å¾ã€Œå‚æ•°å–å€¼æ— é™å¤šã€çš„ã€Œæœ‰å‚è¡Œä¸ºã€
 *   * ç›®å‰å¯¹åº”ï¼š
 *     * éè´Ÿæ•°â‡’è½¬å‘ã€Œä»»æ„ç»´æ•´æ•°è§’ã€n
 *     * è´Ÿæ•°â‡’è½¬å‘ã€Œä»»æ„ç»´æ•´æ•°è§’ã€(-n-1) + å‰è¿›
 *   * ä¾‹å¦‚ã€Œè½¬å‘ã€ã€Œç§»åŠ¨ã€
 *
 * ?ã€2023-10-09 18:20:51ã€‘ç›®å‰è¿™æ ·åˆ©ç”¨åŸºç¡€ç±»å‹æ˜¯å¦è¿‡äºéšæ„ï¼Œä¸åˆ©äºåç»­åŠ å…¥ã€Œæœ‰å‚è¡Œä¸ºã€ï¼Ÿ
 */
export type PlayerAction = string | int

/**
 * ä¸€ä¸ªç”¨äºç»Ÿä¸€æ‰€æœ‰ç©å®¶è¾“å‡ºçš„æšä¸¾
 * * ç”¨äºåœ¨ç©å®¶æ¥æ”¶äº‹ä»¶æ—¶åˆ†æ´¾
 */
export enum EnumNativePlayerAction {
	// **ç©ºæ“ä½œ** //
	/**
	 * ç©ºæ“ä½œ
	 * * ä¸ä¼šè¢«ã€ŒAIæ§åˆ¶å™¨ã€åˆ†æ´¾
	 * * æ‰§è¡Œæ—¶ä¸ä¼šåšä»»ä½•äº‹æƒ…
	 */
	NULL = '',

	// **åŸºæœ¬æ“ä½œé›†** //

	/**
	 * å‘å‰ç§»åŠ¨
	 */
	MOVE_FORWARD = 'moveForward',

	/**
	 * è½¬å‘æŸæ–¹å‘
	 *
	 * ! è¿™æ˜¯ä¸€ç³»åˆ—æ“ä½œçš„å‰ç¼€
	 * * å®Œæ•´å½¢å¼ä¸ºã€Œè½¬å‘æŸæ–¹å‘(æ–¹å‘)ã€
	 * * æ•°å€¼å¯¹åº”å…³ç³»ï¼šæ­£æ•´æ•°â‡’è½¬å‘ã€Œä»»æ„ç»´æ•´æ•°è§’ã€n
	 *
	 * * ğŸ’­æ•°å€¼-å­—ç¬¦ä¸²è½¬æ¢ç¡®å®æŒºä½æ•ˆï¼Œè¿˜ä¸å¦‚ç±»å‹ä¸ç¨³å®š
	 */
	// TURN_TO_ = 'moveToward_',

	/**
	 * è½¬å‘åæ–¹
	 * * ã€Œå‘åç§»åŠ¨ã€å¯ä»¥è¡¨ç¤ºä¸ºäºŒè€…çš„å¤åˆ
	 */
	TURN_BACK = 'turnBack',

	// **ä¸€äº›å¤åˆæ“ä½œ** //

	/**
	 * å‘æŸæ–¹å‘å‰è¿›ï¼ˆä¸€æ ¼ï¼‰
	 * * åˆ†è§£ï¼šè½¬å‘æŸæ–¹å‘+å‰è¿›ï¼ˆä¸€æ ¼ï¼‰
	 *
	 * ! è¿™æ˜¯ä¸€ç³»åˆ—æ“ä½œçš„å‰ç¼€
	 * * å®Œæ•´å½¢å¼ä¸ºã€Œå‘æŸæ–¹å‘å‰è¿›(æ–¹å‘)ã€
	 * * æ•°å€¼å¯¹åº”å…³ç³»ï¼šè´Ÿæ•´æ•°â‡’è½¬å‘ã€Œä»»æ„ç»´æ•´æ•°è§’ã€(-n-1) + å‰è¿›
	 *
	 * * ğŸ’­æ•°å€¼-å­—ç¬¦ä¸²è½¬æ¢ç¡®å®æŒºä½æ•ˆï¼Œè¿˜ä¸å¦‚ç±»å‹ä¸ç¨³å®š
	 */
	// MOVE_TOWARD_ = 'moveToward_',

	/**
	 * å‘åç§»åŠ¨ï¼ˆä¸€æ ¼ï¼‰
	 * * åˆ†è§£ï¼šè½¬å‘åæ–¹+å‰è¿›ï¼ˆä¸€æ ¼ï¼‰
	 */
	MOVE_BACK = 'moveBack',
}

/**
 * ä»ã€Œè½¬å‘æ–¹å‘ã€è·å–å¯¹åº”çš„ã€Œç©å®¶è¡Œä¸ºã€
 * *ã€2023-11-10 19:30:23ã€‘è½¬æ¢å…³ç³»ï¼šç›´æ¥å¯¹åº”
 *
 * @param direction è½¬å‘æ–¹å‘ï¼ˆä»»æ„ç»´æ•´æ•°è§’ï¼‰
 * @returns å¯¹åº”çš„ç©å®¶è¡Œä¸º
 */
export function getPlayerActionFromTurn(direction: mRot): PlayerAction {
	return direction as PlayerAction
}

/**
 * åˆ¤æ–­ä¸€ä¸ªã€Œç©å®¶è¡Œä¸ºã€æ˜¯å¦ä¸ºã€Œè½¬å‘ã€
 * *ã€2023-11-10 19:31:09ã€‘åˆ¤æ–­ä¾æ®ï¼šæ˜¯å¦ä¸ºéè´Ÿæ•´æ•°
 *
 * @param action ç©å®¶è¡Œä¸º
 * @returns æ˜¯å¦ä¸ºã€Œè½¬å‘ã€è¡Œä¸º
 */
export function isActionTurn(action: PlayerAction): boolean {
	return typeof action === 'number' && action >= 0
}

/**
 * åˆ¤æ–­ä¸€ä¸ªã€Œç©å®¶è¡Œä¸ºã€æ˜¯å¦ä¸ºã€Œè½¬å‘+ç§»åŠ¨ã€
 * *ã€2023-11-10 19:31:09ã€‘åˆ¤æ–­ä¾æ®ï¼šæ˜¯å¦ä¸ºè´Ÿæ•´æ•°
 *
 * @param action ç©å®¶è¡Œä¸º
 * @returns æ˜¯å¦ä¸ºã€Œè½¬å‘ã€è¡Œä¸º
 */
export function isActionMoveForward(action: PlayerAction): boolean {
	return typeof action === 'number' && action < 0
}

/**
 * ä»ã€Œç©å®¶è¡Œä¸ºã€è·å–å¯¹åº”çš„ã€Œè½¬å‘æ–¹å‘ã€
 * *ã€2023-11-10 19:49:45ã€‘è½¬æ¢æ–¹æ³•ï¼šç›´æ¥å¯¹åº”
 *
 * ! æ³¨æ„ï¼šä¸ä¼šæ£€æŸ¥ã€Œç©å®¶è¡Œä¸ºã€çš„ç±»å‹ï¼ˆå­—ç¬¦ä¸²ç±»ã€Œæšä¸¾å‹è¡Œä¸ºã€éœ€è¦é¢„å…ˆæ£€æµ‹ï¼‰
 *
 * @param action ç©å®¶è¡Œä¸º
 * @returns å¯¹åº”çš„è½¬å‘æ–¹å‘ï¼ˆä»»æ„ç»´æ•´æ•°è§’ï¼‰
 */
export function toRotFromActionTurn(action: PlayerAction): mRot {
	return action as mRot
}

/**
 * ä»ã€Œç©å®¶è¡Œä¸ºã€è·å–å¯¹åº”çš„ã€Œç§»åŠ¨æ–¹å‘ã€
 * *ã€2023-11-10 19:50:26ã€‘è½¬æ¢æ–¹æ³•ï¼š`a => -a - 1`(a<0)
 *
 * ! æ³¨æ„ï¼šä¸ä¼šæ£€æŸ¥ã€Œç©å®¶è¡Œä¸ºã€çš„ç±»å‹ï¼ˆå­—ç¬¦ä¸²ç±»ã€Œæšä¸¾å‹è¡Œä¸ºã€éœ€è¦é¢„å…ˆæ£€æµ‹ï¼‰
 *
 * @param action ç©å®¶è¡Œä¸º
 * @returns å¯¹åº”çš„ç§»åŠ¨æ–¹å‘ï¼ˆä»»æ„ç»´æ•´æ•°è§’ï¼‰
 */
export function toRotFromActionMoveForward(action: PlayerAction): mRot {
	return -action - 1
}
